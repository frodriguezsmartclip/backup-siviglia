<style>
    .remove, .NewItemString .add {
        font-family:'IcoMoon'
    }
    .remove:before {

    }
    .description:empty {display:none}
    .NewItemString .add {
        margin-left: 5px;
        margin-top: 6px;
        color: green;
    }
    .add:before {
        font-family:"Ionicons";
        content: '\f359';
        font-size: 20px;
    }
    .remove {
        font-family: 'IcoMoon';
    }
    input[type=checkbox]{
        width:15px !important;
        height:15px !important;
    }
    .ContainerType {}

    .ContainerType .ContainerType .containerLabel {
        min-width:150px !important;
        font-size:12px
    }
    .containerInput {
        display: table-cell;
    }
    .dictionaryInput {
        min-width:200px
    }
    .removebutton:after {
        font-family:"Ionicons";
        font-size: 16px;
        content: "\f128";
        color: darkred;
        margin-top: 7px;
        margin-left: 5px;
    }
    .navbar-form {
        padding:0px !important;
    }
</style>
<script>

    Siviglia.Utils.buildClass(
        {
            context: 'Siviglia.inputs.jqwidgets',
            classes: {
                Factory:{
                    methods:{
                        getInput:function(type,params,form)
                        {
                            var stype=type.type;
                            var d=$.Deferred();
                            if(!Siviglia.isset(params))
                                params={};
                            if(Siviglia.isset(params.controller))
                                type.setController(params.controller);
                            var dv=$('<div></div>');
                            var p=params || {};
                            var formParams=form.getFormParams(type.getFullPath());
                            if(formParams)
                            {
                                for(var k in formParams)
                                    p[k]=formParams[k];
                            }
                            p.type=type;
                            p.form=form;


                            var input=Siviglia.issetOr(p["INPUT"],null);
                            if(!input) {
                                switch (stype) {
                                    case "Integer":
                                    case "String": {
                                        if (type.hasSource())
                                            input = "ComboBox";
                                        else
                                            input=stype;
                                    }
                                        break;
                                    default:
                                    {
                                        input=stype
                                    }
                                }
                            }
                            if(type.relaxed)
                            {
                                switch(stype)
                                {
                                    case "Boolean":
                                    {
                                        input="BooleanCombo";
                                    }break;
                                }
                            }
                            var stack = new Siviglia.Path.ContextStack();
                            var instance=new Siviglia.inputs.jqwidgets[input](
                                "Siviglia.inputs.jqwidgets."+input,
                                p,
                                {},
                                dv,
                                stack
                            );
                            instance.__build().then(function(){
                                // Se crea el layout y se le pasa la instancia.

                                d.resolve(instance);

                            })
                            return d;

                        }
                    }
                },

                Form:{
                  inherits:"Siviglia.UI.Expando.View,Factory",
                  destruct:function(){
                      if(this.container!==null)
                          this.container.destruct();
                      if(this.formNode)
                      this.formNode.html("");
                  }  ,
                  methods:
                      {
                          preInitialize:function(params)
                          {
                              // En los Params ya tiene que haber un baseTypedObject, inicializado con valores.
                              // La mision del form no es esa.Es solo pintar.
                              // Se crea un tipo Container, con el valor que nos hayan pasado.
                              this.value=params.value;
                              this.container=new Siviglia.types.Container(this.value);
                              var ip=Siviglia.issetOr(params.value.__definition.INPUTPARAMS,{});
                              this.ip=[];
                              for(var k in ip)
                              {
                                  var t=k.replace(/\+/gm,'.*')
                                  t=t.replace(/\*/gm,'[^/]*');
                                  t=t.replace(/\//,'\\/');
                                  var r=new RegExp("^"+t+"$");
                                  this.ip.push({reg:r,ip:ip[k]});
                              }
                          },
                          initialize:function(params)
                          {
                              var factory=new Siviglia.inputs.jqwidgets.Factory();
                              factory.getInput(this.container,{},this).then(function(instance){
                                  this.container=instance;
                                  this.formNode.append(this.container.rootNode);
                              }.bind(this))

                          },
                          getFormParams:function(typePath)
                          {
                              var curP={};
                              this.ip.map(function(item){
                                  if(typePath.match(item.reg))
                                      curP=Siviglia.deepmerge(curP,item.ip);
                              })
                              return curP;
                          }
                      }
                },

                BaseInput: {
                    inherits: "Siviglia.UI.Expando.View,Siviglia.Dom.EventManager",

                    methods: {
                        preInitialize: function (params) {
                            this.errored = false;
                            this.controller = this.parentView;
                            this.changing=false;
                            this.errorMessage = "";
                            this.form=Siviglia.issetOr(params.form,null);
                            this.type = params.type;
                            this.type.addListener("CHANGE",this,"onTypeChanged");
                            this.helpMessage = Siviglia.issetOr(this.type.definition.HELP, null);
                            this.hasHelpMessage = (this.helpMessage != null ? true : false);
                            this.inputParams = Siviglia.issetOr(params.inputParams, {});
                            this.formParams=Siviglia.issetOr(params.formParams,{});
                        },
                        initialize: function (params) {
                            var opts = this.getDefaultInputOptions();
                            for (var k in this.inputParams)
                                opts[k] = this.inputParams[k];
                            this.createInput(opts);
                            this.inputNode[this.getJqxWidgetName()]('theme', 'light');
                            var m = this;
                            this.inputNode.on("change", function () {
                                if (m.changing)
                                    return;
                                m.changing=true;
                                try {
                                    if (m.validate())
                                        m.type.setValue(m.getValue());
                                }catch(e)
                                {
                                    this.showError(
                                        Siviglia.i18n.es.base.getErrorFromJsException(e)
                                    );
                                }
                                m.changing=false;

                            })
                            if (this.type.is_set()) {
                                var toSet = this.type.getValue();
                                this._setInputValue(toSet);
                            }
                        },
                        onTypeChanged:function(event,params)
                        {
                            if(this.changing===false)
                            this._setInputValue(params.value);
                        },
                        detach:function()
                        {
                            this.Widget$detach();
                            this.type.removeListeners(this);
                        },

                        getDefaultInputOptions: function () {
                            return {};
                        },
                        createInput: function (options) {

                            return this.callInp(options)
                        },
                        _setInputValue: function (toSet) {
                            this.changing = true;
                            this.inputNode[this.getJqxWidgetName()]('val', toSet);
                            this.changing = false;
                        },
                        getValue: function () {
                            return this.inputNode[this.getJqxWidgetName()]('val');
                        },
                        validate: function () {
                            var val = this.getValue();
                            try {
                                this.type.validate(val);
                                this.clearErrors();
                                return true;
                            } catch (e) {
                                this.showError(
                                    Siviglia.i18n.es.base.getErrorFromJsException(e)
                                );
                            }
                            return false;
                        },
                        showError: function (message) {
                            var d = new Date();
                            this.tooltip = this.inputNode.jqxTooltip(
                                {
                                    name: d + d.getMilliseconds(),
                                    animationShowDelay: 'fast',
                                    autoHide: false,
                                    closeOnClick: false,
                                    position: 'right'
                                });
                            this.inputNode.jqxTooltip({content: message});
                            this.inputNode.jqxTooltip("open");
                            this.inputNode.addClass("errored");
                        },
                        clearErrors: function () {
                            if (this.tooltip)
                                this.inputNode.jqxTooltip('destroy');
                            this.inputNode.removeClass("errored");
                            /*if(this.validator)
                             ths.validator.hide();*/
                        },
                        getJqxWidgetName: function () {
                            return "jqxInput";
                        },
                        callInp: function (obj) {
                            return this.inputNode[this.getJqxWidgetName()](obj);
                        },
                        disable: function () {
                            this.callInp({disabled: true});
                        },
                        enable: function () {
                            this.callInp({disabled: false});
                        },
                        on:function(event,callback)
                        {
                            this.inputNode.on(event,callback);
                        }
                    }
                },
                String: {
                    /*
                     disabled	Boolean	false
                     dropDownWidth	Number/String	null
                     displayMember	String	""
                     height	Number/String	null
                     items	Number	8
                     minLength	Number	1
                     maxLength	Number	null
                     opened	Boolean	false
                     placeHolder	String	""
                     popupZIndex	Number	20000
                     query	String	""
                     renderer	function	null
                     rtl	Boolean	false
                     searchMode	String	'default'
                     source	Array, function	[]
                     theme	String	''
                     valueMember	String	""
                     width
                     */
                    inherits: "Siviglia.inputs.jqwidgets.BaseInput",
                    methods: {
                        getDefaultInputOptions: function () {
                            var d = this.type.definition;
                            var opts = {};
                            if (d.MINLENGTH)
                                opts.minLength = d.MINLENGTH;
                            if (d.MAXLENGTH)
                                opts.maxLength = d.MAXLENGTH;
                            return opts;
                        }

                    }
                },
                Enum: {
                    inherits: 'BaseInput',
                    methods: {
                        getDefaultInputOptions: function () {
                            var finalOpts = [];
                            var d = this.type.definition;
                            for (var k = 0; k < d.VALUES.length; k++) {
                                var c = d.VALUES[k];
                                var label, value;
                                label = value = c;
                                if (typeof c == "object") {
                                    label = c.LABEL;
                                    value = c.VALUE;
                                }
                                finalOpts.push(
                                    {
                                     //   html: '<div tabIndex=0 style="padding:1px">' + label + '</div>',
                                        label: label,
                                        value: value
                                    }
                                )
                            }
                            var opts = {
                                source: finalOpts, //finalOpts,
                                placeHolder: 'Seleccionar',
                                autoComplete: false,
                                height: 25,
                                displayMember: "label",
                                valueMember: "value",
                                width: 200, minLength: 0
                            };
                            return opts;
                        },
                        getJqxWidgetName: function () {
                            return "jqxComboBox";
                        },
                        _setInputValue:function(v)
                        {
                            this.changing = true;
                            var curLabel=this.type.getLabel();
                            this.inputNode[this.getJqxWidgetName()]('val', curLabel);
                            this.changing = false;
                        }
                    }
                },
                Integer: {
                    inherits: 'BaseInput',
                    methods: {
                        /* {value: null,
                         decimal: 0,
                         min: -99999999,
                         max: 99999999,
                         width: 200,
                         validationMessage: "Invalid value",
                         height: 25, textAlign: "right", readOnly: false,
                         promptChar: "*",
                         decimalDigits: 2,
                         decimalSeparator: ".", groupSeparator: ",", groupSize: 3, symbol: "", symbolPosition: "left", digits: 8, negative: false, negativeSymbol: "-", disabled: false, inputMode: "advanced", spinButtons: false, spinButtonsWidth: 18, spinButtonsStep: 1, autoValidate: true, spinMode: "advanced", enableMouseWheel: true, touchMode: "auto", rtl: false, events: ["valueChanged", "textchanged", "mousedown", "mouseup", "keydown", "keyup", "keypress", "change"], aria: {"aria-valuenow": {name: "decimal", type: "number"}, "aria-valuemin": {name: "min", type: "number"}, "aria-valuemax": {name: "max", type: "number"}, "aria-disabled": {name: "disabled", type: "boolean"}}, invalidArgumentExceptions: ["invalid argument exception"]};
                         */
                        getDefaultInputOptions: function () {

                            return {decimalDigits: 0};
                        },
                        getJqxWidgetName: function () {
                            return "jqxNumberInput";
                        }
                    }
                },
                Decimal: {
                    inherits: 'BaseInput',
                    methods: {
                        getDefaultInputOptions: function () {
                            var d = this.type.definition;
                            return {decimalDigits: d.NDECIMALS, digits: d.NINTEGERS};
                        },
                        getJqxWidgetName: function () {
                            return "jqxNumberInput";
                        }
                    }
                },
                Text: {
                    inherits: 'BaseInput',
                    methods: {
                        initialize: function (params) {
                            var m = this;
                            $(document).ready(function () {
                                m.BaseInput$initialize(params);
                            });
                        },
                        getDefaultInputOptions: function () {
                            return {
                                height: "400px",
                                width: '800px'
                            };
                        },
                        getJqxWidgetName: function () {
                            return "jqxEditor";
                        }

                    }
                },
                AutoIncrement: {
                    inherits: 'Siviglia.UI.Expando.View,Siviglia.Dom.EventManager',
                    methods: {
                        preInitialize: function (params) {
                            this.value = params.type.getValue();
                        },
                        initialize: function (params) {
                        },
                        getValue: function () {
                            return this.type.getValue();
                        }
                    }
                },
                Boolean: {
                    inherits: 'BaseInput',
                    methods: {
                        getDefaultInputOptions: function () {
                            return {width: 20, height: 20};
                        },
                        getJqxWidgetName: function () {
                            return "jqxCheckBox";
                        },
                        _setInputValue: function (value) {
                            if (value == null || value == "0" || value == "false" || value == false)
                                this.inputNode.jqxCheckBox({checked: false});
                            else
                                this.inputNode.jqxCheckBox({checked: true});
                        },
                        getValue: function () {
                            return this.inputNode.val() ? "1" : "0";
                        }
                    }
                },

                ComboBox: {
                    inherits: 'BaseInput',

                    methods: {
                        preInitialize: function (params) {
                            this.preprocessParams(params);
                            this.source=null;
                            this.dataBinding=false;
                            this.BaseInput$preInitialize(params);
                        },
                        initialize: function (params) {

                            var opts = this.getDefaultInputOptions();
                          //  for (var k in this.inputParams)
                          //      opts[k] = this.inputParams[k];
                            this.createInput(opts);
                            this.inputNode[this.getJqxWidgetName()]('theme', 'light');
                            var m = this;
                            this.inputNode.on("select", function (ev) {
                                if(!m.dataBinding) {
                                    if (ev.args) {
                                        m.changing = true;
                                        var newVal = ev.args.item.value;
                                        if (newVal == -1) {
                                            m.type.setValue(null);

                                        } else {
                                            if (m.validate())
                                                m.type.setValue(m.getValue());
                                        }
                                        m.changing = false;
                                    }
                                }
                                else
                                {
                                    m._setInputValue(null);
                                }
                            })


                            if (this.disabled) {

                                this.disable();
                                return;
                            }
                            else
                                this.refresh();

                        },
                        detach:function()
                        {
                            this.BaseInput$detach();
                            if(this.source)
                                this.source.removeListeners(this);
                        },
                        preprocessParams: function (params) {
                            this.type=params.type;
                            var s=this.type.getSource();
                            this.labelField = s.getLabelExpression()?"LABEL_EXPRESSION":s.getLabelField();
                            this.valueField = s.getValueField();
                        },
                        getValue: function () {
                            var v = this.inputNode.jqxComboBox('val');
                            if (v == '')
                                v = null;
                            return v;
                        },
                        getJqxWidgetName: function () {
                            return "jqxComboBox";
                        },
                        getDefaultInputOptions: function () {
                            var self = this;
                            this.dataSource = {
                                localdata: [],
                                datatype: "array"
                            };
                            this.dataAdapter = new $.jqx.dataAdapter(self.dataSource);
                            return {
                                source: this.dataAdapter,
                                openDelay: 200,
                                autoComplete: true,
                                autoBind: false,
                                minLength: 1,
                                remoteAutoComplete: true,
                                displayMember: this.getLabelField(),
                                valueMember: this.getValueField(),
                                autoDropDownHeight: true,
                                width: 200,
                                height: 25,
                                placeHolder:Siviglia.issetOr(this.inputParams["placeholder"],"--Select"),
                                search: function (str) {
                                    console.log("SEARCHING");
                                    self.source.setSearch
                                   // self.searchString = str;
                                   // self.refresh();
                                }
                            };
                        },
                        _setInputValue: function (toSet) {
                            if (this.changing)
                                return;
                            this.changing = true;
                            if(toSet==null)
                            {

                                this.inputNode.jqxComboBox('selectItem',-1);
                                this.inputNode.jqxComboBox('val','');
                                this.type.setValue(null);

                            }
                            else {
                                var item = this.inputNode.jqxComboBox('getItemByValue', toSet);
                                if (item) {
                                    this.inputNode.jqxComboBox('selectItem', item);
                                    this.inputNode.jqxComboBox('val', item.label);
                                }
                            }
                            this.changing = false;
                        },
                        getLabelField: function () {
                            return this.labelField;
                        },
                        getValueField: function () {
                            return this.valueField;
                        },
                        buildParameters: function () {
                            var obj = {
                                "search": this.searchString
                            };
                            if (this.sourceParameters) {
                                for (var k in this.sourceParameters) {
                                    obj[k] = this.sourceParameters[k];
                                }
                            }
                            return obj;
                        },
                        refresh: function () {
                            if (this.disabled)
                                return;
                            var params = this.buildParameters();
                            this.getSource(params);

                        },
                        getSource: function (params) {
                            if(this.source==null) {
                                //this.type.clear();
                                var plainCtx = new Siviglia.Path.BaseObjectContext(this.controller, "*");
                                var s = this.type.getSource();
                                s.addContext(plainCtx);
                                s.addListener("CHANGE", this, "onSourceChanged");

                                this.source=s;
                            }
                            this.source.fetch();
                            return this.source;

                        },
                        onSourceChanged:function(evName,data)
                        {
                            var self=this;
                            // Vemos ahora en data

                            this.dataSource.localdata = [];
                            if(data.value!==null)
                            {
                                this.dataSource.localdata=data.value;
                                if(this.source.getLabelExpression()!==null) {
                                    for (var k = 0; k < data.value.length; k++)
                                        data.value[k]["LABEL_EXPRESSION"]=this.source.getLabel(data.value[k])

                                }
                            }

                            // La llamada a dataBind genera un problema en select anidados:
                            // Si existen dos select anidados, S1 y S2, ocurre lo siguiente:
                            // Inicialmente, S1 y S2 estÃ¡n en blanco. Se selecciona un item de S1. S2 sigue en blanco.
                            // Se selecciona ahora un valor de S2.
                            // Posteriormente, se cambia el valor de S1. El valor de S2 ahora deberia ponerse en blanco,
                            // ya que su valor dependia del valor antiguo de S1.
                            // En vez de eso, lo que ocurre es que al llamar a dataBind, se genera un evento "select", y se
                            // autoselecciona el primer valor del nuevo set de datos asignado a S2.
                            // Por eso, se marca que estamos haciendo el databind, para controlarlo en el gestor de eventos.
                            this.dataBinding=true;
                            self.dataAdapter.dataBind();
                            this.dataBinding=false;
                            if (self.type.is_set()) {
                                var toSet = self.type.getValue();
                                var it = self.inputNode.jqxComboBox('getItemByValue', toSet);
                                if (it) {
                                    self._setInputValue(toSet);
                                }
                                else
                                    self.type.unset();
                            }
                        }

                    }
                },
                BooleanCombo:{
                    inherits:"ComboBox",
                    methods:{
                        preInitialize: function (params) {
                            this.source=null;
                            this.dataBinding=false;
                            this.labelField="LABEL";
                            this.valueField="VALUE";
                            this.BaseInput$preInitialize(params);
                        },
                        getSource: function (params) {
                            if(this.source==null) {
                                //this.type.clear();
                                var stack = new Siviglia.Path.ContextStack();
                                var factory=new Siviglia.Data.SourceFactory();
                                var s=factory.getFromSource({
                                    "TYPE": "Array",
                                    "DATA":
                                        [
                                            {"LABEL":"Seleccionar","VALUE":null},
                                            {"LABEL":"True","VALUE":true},
                                            {"LABEL":"False","VALUE":false}
                                        ],
                                    "LABEL":"LABEL",
                                    "VALUE":"VALUE"
                                },this.type,stack);
                                s.addListener("CHANGE", this, "onSourceChanged");
                                this.source=s;
                            }
                            this.source.fetch();
                            return this.source;
                        }
                    }
                },
                FixedSelect:
                    {
                        inherits: 'ComboBox',
                        methods:{
                            getDefaultInputOptions:function()
                            {
                                var self = this;
                                this.dataSource = {
                                    localdata: [],
                                    datatype: "array"
                                };
                                this.dataAdapter = new $.jqx.dataAdapter(self.dataSource);
                                return {
                                    source: this.dataAdapter,
                                    autoBind: true,
                                    displayMember: this.getSearchField(),
                                    valueMember: this.getValueField(),
                                    autoDropDownHeight: true,
                                    width: 200,
                                    height: 25,
                                    placeHolder:Siviglia.issetOr(this.inputParams["placeholder"],null)
                                };
                            }
                        }
                    },
                Relationship:{
                    inherits:'ComboBox'
                },
                Date:{
                    inherits:'BaseInput',
                    methods:
                        {
                            getDefaultInputOptions: function () {
                               return {};
                            },
                            getJqxWidgetName: function () {
                                return "jqxDateTimeInput";
                            },
                            getValue:function()
                            {
                                var val = this.inputNode.jqxDateTimeInput('value');
                                if (val != null)
                                {
                                    var v=val.getMonth()+1;
                                    if(v<10)
                                        v='0'+v;
                                    var d=val.getDate();
                                    if(d<10)
                                        d='0'+d;
                                    var tt= val.getFullYear() + "-" + v + "-" + d;
                                    console.dir(tt);
                                    return tt;
                                }
                                return null;
                            }
                        }
                },
                DateTime:{
                    inherits:'Date',
                    methods:
                        {
                            getValue: function () {
                                var val = this.inputNode.jqxDateTimeInput('value');
                                if (val != null)
                                {
                                    var v=val.getMonth()+1;
                                    if(v<10)
                                        v='0'+v;
                                    var d=val.getDate();
                                    if(d<10)
                                        d='0'+d;
                                    var h=val.getHours();
                                    if(h<10)
                                        h='0'+h;
                                    var m=val.getMinutes();
                                    if(m<10)
                                        m='0'+m;
                                    var s=val.getSeconds();
                                    if(s<10)
                                        s='0'+s;

                                    return val.getFullYear() + "-" + v + "-" + d + " " + h + ":" + m + ":" + s;
                                }
                                return null;
                            }
                        }
                },
                Money:{
                    inherits:'Decimal'
                },
                Password:{
                    inherits:'String'
                },
                State:{
                    inherits:'Enum'
                },
                Name:{
                    inherits:'String'
                },
                Street:{
                    inherits:'String'
                },
                City:{
                    inherits:'String'
                },
                Phone:{
                    inherits:'String'
                },
                UUID:{
                    inherits:'String'
                },
                Dictionary:
                    {
                        inherits:'BaseInput',
                        destruct:function()
                        {

                            if(this.currentWidget)
                                this.currentWidget.destruct();
                            this.currentWidget=null;

                        },
                        methods:
                            {
                                preInitialize:function(params)
                                {
                                    this.title="";
                                    this.hasSimpleType=false;
                                    this.description="";
                                    this.BaseInput$preInitialize(params);
                                    if(this.type.getValue()===null)
                                        this.type={};
                                    this.currentWidget=null;
                                    this.hasCurrentKey=false;
                                    this.currentKey=null;
                                    this.params=params;
                                },
                                initialize:function(params)
                                {
                                },
                                buildNewItemWidget:function(node,params)
                                {

                                    if(this.newItemWidget) {
                                        this.newItemWidget.destruct();
                                    }
                                    node.html("");
                                    var pp=this.params;
                                    pp.parent=this;
                                    var tempNode=$("<div></div>");
                                    this.newItemWidget=new Siviglia.inputs.jqwidgets.NewItem('Siviglia.inputs.jqwidgets.NewItem',
                                        pp,
                                        {},
                                        tempNode,
                                        this.__context
                                    );
                                    this.newItemWidget.__build().then(function(){node.append(tempNode);})

                                },
                                onLabelClicked:function(node, params)
                                {
                                    console.log("*****LABEL CLICKED*****");
                                    this.currentKey=params.key;
                                    this.hasCurrentKey=true;

                                },
                                getInputFor:function(node,params)
                                {
                                    if(this.currentWidget!=null) {
                                        this.currentWidget.destruct();
                                        this.currentWidget = null;
                                        node.html("");
                                    }
                                    if(params.key==null)
                                        return;

                                    this.__getInputFor(params.key).then(function(instance){
                                        this.currentWidget=instance;
                                        node.append(this.currentWidget.rootNode);
                                    }.bind(this));
                                },
                                __getInputFor:function(key)
                                {
                                    var l;
                                    var p=$.Deferred();
                                    var factory=new Siviglia.inputs.jqwidgets.Factory()
                                    //this.curType=this.type.getField(key);
                                    this.curType=this.type.getValue()["*"+key];
                                    factory.getInput(this.curType,{controller:this.type.controller},this.form).then(
                                        function(instance){
                                            if(this.curType.definition.LAYOUT)
                                                l = this.curType.definition.LAYOUT;
                                            else
                                                l = "Siviglia.inputs.jqwidgets.DefaultLayout";
                                            var s=Siviglia.Utils.stringToContextAndObject(l);
                                            var lay=new s.context[s.object](l,{name:key,input:instance},{},$('<div></div>'),this.__context);
                                            lay.__build().then(function(){

                                                p.resolve(lay)
                                            });
                                        }.bind(this));
                                    return p;

                                },
                                getLabel:function(node,params,event)
                                {
                                    var curKey=params.key;
                                    node.html(this.type.definition.FIELDS[curKey].LABEL || curKey);
                                },
                                onRemoveClicked:function(node,params,event)
                                {
                                    if(params.key==this.currentKey && this.currentWidget!=null)
                                    {
                                        this.currentWidget.destruct();
                                    }
                                    this.hasCurrentKey=false;
                                    this.currentKey=null;
                                    this.currentWidget=null;
                                    var v=this.type.getValue();
                                    delete v[params.key];
                                    //this.type.removeItem(params.key);

                                },
                                onAdd:function(val)
                                {
                                    this.type.addItem(val);
                                    this.onLabelClicked(null,{key:val});
                                },

                            }
                    },
                Container:
                    {
                        inherits:'Dictionary',
                        destruct:function(){

                            for(var k in this.subwidgets)
                                this.subwidgets[k].destruct();
                        },
                        methods: {
                            preInitialize:function(params)
                            {
                                this.subwidgets={};
                                this.Dictionary$preInitialize(params);

                            },
                            getInputFor: function (node, params) {

                                if(typeof this.type.definition.FIELDS[params.key]=="undefined") {
                                    console.error("ERROR:LLamado getInputFor de Container con un campo no valido:" + params.key);
                                    return;
                                }
                                this.__getInputFor(params.key).then(function(instance){
                                this.subwidgets[params.key]=instance;
                                node.append(this.subwidgets[params.key].rootNode);
                                }.bind(this));
                            },
                            getGroups:function()
                            {
                                var groups=this.type.getGroups();
                                if(groups==null)
                                {
                                    return {"DEFAULT":{"LABEL":"Default","FIELDS":this.type.getKeys()}};
                                }
                                return groups;
                            }
                        }
                    },
                TabbedContainer:{
                    inherits:"Container",
                    methods:{
                        preInitialize:function(params)
                        {
                            this.Container$preInitialize(params);

                            this.containerDefinition=this.type.getDefinition();

                            this.containerGroups=this.getGroups();
                            this.labels=[];
                            for(var k in this.containerGroups)
                            {
                                this.labels.push(this.containerGroups[k].LABEL);
                                this.containerGroups[k].ICON=Siviglia.issetOr(this.containerGroups[k].ICON,"");
                            }
                        },
                        initialize:function(params)
                        {
                            this.Container$initialize(params);
                            this.jqxTabs.append(this.groups.children())
                            var iParams=Siviglia.issetOr(this.formParams["JQXPARAMS"],{ width: 600, height: 250, position: 'top'});
                            this.jqxTabs.jqxTabs(iParams);
                        }
                    }
                },
                FlexContainer:{
                    inherits:"Container"
                },
                FixedDictionary:
                    {
                        inherits:'Dictionary',
                        methods: {
                            preInitialize: function (params) {
                                this.BaseInput$preInitialize(params);
                                this.currentWidget = null;
                                this.hasCurrentKey=false;
                                this.currentKey = null;
                            },
                            buildNewItemWidget: function (node, params) {
                                if (this.newItemSelector) {
                                    this.title = "The title";
                                    this.description = "The Description";
                                    this.newItemSelector.destruct();
                                    this.newItemSelector = null;
                                }
                                var uinode = this.params.type;
                                var opts = uinode.getAvailableKeys();

                                if (opts.length > 0) {
                                    var tempType=new Siviglia.types.Enum({
                                        "TYPE":"Enum",
                                        "VALUES":opts
                                    })
                                    var factory=new Siviglia.inputs.jqwidgets.Factory();
                                    factory.getInput(tempType,{},this.form).then(function(instance){
                                    this.newItemSelector =instance;
                                    var m = this;
                                    this.newItemSelector.on("change", function (ev) {
                                        var curLabel = m.newItemSelector.getValue();
                                        var tt = m.type.getPossibleKeys();
                                        for (var k=0;k<tt.length;k++) {
                                            if (tt[k] == curLabel) {
                                                m.onChangeType(tt[k]);
                                                m.buildNewItemWidget(node, {});
                                            }
                                        }
                                    });
                                    node.append(this.newItemSelector.node);
                                    }.bind(this));
                                }

                            },
                            onChangeType: function (val) {
                                this.type.addItem(val);
                                this.onLabelClicked(null, {key: val});

                            },
                            onRemoveClicked: function (node, params, event) {
                                this.DictionaryPainter$onRemoveClicked(node, params, event);
                                this.buildNewItemWidget(this.newItemNode);
                            }
                        }

                    },
                Array:
                    {
                        inherits:'BaseInput',
                        methods:
                            {
                                preInitialize:function(params)
                                {

                                    this.BaseInput$preInitialize(params);
                                    this.value=params.type.getValue()
                                    this.newInstance=null;
                                    this.hasSimpleType=this.type.areContentsSimple();
                                    this.changing=false;
                                    this.currentItem=null;

                                },
                                initialize:function(params)
                                {

                                },
                                onRemoveClicked:function(node,params)
                                {
                                    this.type.splice(params.key,1);
                                },
                                buildNewItemWidget:function(node,params)
                                {
                                    if(this.newItemWidget) {
                                        this.newItemWidget.destruct();
                                        this.newInstance.destruct();
                                    }
                                    this.newItemNode.html("");
                                    this.newInstance=this.type.getValueInstance();
                                    var factory=new Siviglia.inputs.jqwidgets.Factory();

                                    factory.getInput(this.newInstance,{},this.form).then(function(instance){
                                      this.newItemSelector =instance;
                                        this.newItemNode.append(this.newItemSelector.rootNode);
                                    }.bind(this));
                                },
                                onRemoveItem:function(node,params)
                                {
                                    var idx=params.index;
                                    var v=this.type.getValue();
                                    v.splice(idx,1);
                                },
                                // Sobreescrito para evitar la llamada a la clase base.
                                onTypeChanged:function()
                                {

                                },
                                onNewItem:function()
                                {
                                    if(this.hasSimpleType) {
                                        if (!this.newInstance.isEmpty())
                                            this.value.push(this.newInstance.getValue());
                                        this.newItemSelector._setInputValue("");
                                        this.newItemSelector.inputNode.focus();
                                    }
                                    else
                                    {
                                        var newInstance=this.type.getValueInstance(0);
                                        this.type.getValue().push(newInstance);
                                    }
                                },

                                getInputFor: function (node, params) {
                                    this.setSelected(params.key)
                                },
                                setSelected:function(idx)
                                {
                                    if(this.currentItem) {
                                        this.currentItem.destruct();
                                        this.currentItemNode.html("");
                                    }
                                    var factory=new Siviglia.inputs.jqwidgets.Factory();
                                    factory.getInput(this.type.getValue()["*"+idx],{},this.form).then(function(instance){
                                    this.currentItem=instance;
                                    this.currentItemNode.append(this.currentItem.rootNode);
                                    }.bind(this));
                                }

                            }
                    },
                ObjectArray: {
                    inherits:'BaseInput',
                    methods: {
                        preInitialize:function(params)
                        {
                            this.BaseInput$preInitialize(params);
                            this.currentWidget=null;
                            this.currentKey=null;
                            this.hasCurrentKey=false;
                            this.keyDirection="HORIZONTAL";

                        },
                        initialize:function(params)
                        {

                            this.nElems=this.type.children.length;
                            this.widgetContainer=$('.currentWidget',this.rootNode);
                        },
                        onLabelClicked:function(node, params)
                        {
                            if(this.currentWidget)
                                this.currentWidget.destruct();
                            this.hasCurrentKey=true;
                            this.currentKey=params.index;
                            var factory=new Siviglia.inputs.jqwidgets.Factory();
                            factory.getInput(tempType,{},this.form).then(function(instance){
                            this.newItemSelector =

                            this.currentWidget=this.painterFactory.factory(this.uinode.children[params.index], this.uinode.parent,{});
                            this.widgetContainer.append(this.currentWidget.rootNode);
                            }.bind(this));
                        },
                        getLabel:function(node,params,event)
                        {
                            if(typeof this.uinode.definition.VALUELABEL!="undefined")
                                node.html(this.uinode.getValue()[params.index][this.uinode.definition.VALUELABEL]);
                            else
                                node.html(params.index);
                        },
                        onRemoveClicked:function(node,params,event)
                        {
                            this.uinode.removeItem(params.index);
                            if(params.index==this.currentKey)
                            {
                                this.currentWidget.destruct();
                            }
                        },
                        addItem:function(node)
                        {
                            var val=this.uinode.addItem(null);
                            this.onLabelClicked(null,{index:this.uinode.children.length-1});
                        },
                        reload:function(event)
                        {
                            this.nElems=this.uinode.children.length;
                            this.BasePainter$reload(event);
                        }

                    }
                },
                TypeSwitcher: {
                    inherits: 'BaseInput',
                    methods:
                        {
                        preInitialize:function(params){
                            this.BaseInput$preInitialize(params);
                            this.subNode = null;
                            this.currentType = null;
                            // Se crea el objeto enum que son los tipos permitidos.
                            var allTypes=params.type.getAllowedTypes();
                            var data=[];
                            for(var k in allTypes)
                                data.push({"LABEL":k,"VALUE":k});
                            var source= {
                                "TYPE": "Array",
                                "DATA":data,
                                "LABEL":"LABEL",
                                "VALUE":"VALUE"
                            };

                            this.typeSelector=Siviglia.types.TypeFactory.getType(this,{
                                "TYPE":"String",
                                "SOURCE":source
                            },this.form);
                            var currentType=params.type.getCurrentType();
                            if(currentType!==null)
                                this.typeSelector.setValue(currentType);

                        },

                        initialize:function(params)
                        {
                            this.detach();
                            var factory=new Siviglia.inputs.jqwidgets.Factory();
                            factory.getInput(this.typeSelector,{},this.form).then(
                                function(instance){
                                    this.typeSelectorWidget =instance;
                                    var m=this;
                                    this.typeSelector.addListener("CHANGE",function(event,params){
                                        var val=m.typeSelector.getValue();
                                        m.type.setCurrentType(val);
                                        m.buildTypeUI();
                                    })

                                    this.typeSwitchSelector.append(this.typeSelectorWidget.rootNode);
                                    this.buildTypeUI();
                            })
                        },
                            detach:function()
                            {

                                if(this.typeSelector!==null) {
                                    this.typeSelector.removeListeners(this);

                                }
                            },
                            buildTypeUI:function()
                            {
                                if(this.subNode) {

                                    this.fieldContainer.html("");
                                    this.subNode.destruct();
                                }

                                var factory=new Siviglia.inputs.jqwidgets.Factory()

                                this.curType=this.type.getCurrentType();

                                if(this.curType) {
                                    var curTypeObj=this.type.getCurrentTypeObj();
                                    factory.getInput(curTypeObj, {controller: this.type.controller},this.form).then(function(instance){
                                        if (curTypeObj.definition.LAYOUT)
                                            l = curTypeObj.definition.LAYOUT;
                                        else
                                            l = "Siviglia.inputs.jqwidgets.DefaultLayout";

                                        var s = Siviglia.Utils.stringToContextAndObject(l);

                                        var lay = new s.context[s.object](l, {
                                            name: this.curType,
                                            input: instance
                                        }, {}, $('<div></div>'), this.__context);
                                        lay.__build().then(function(){
                                            this.subNode=lay;
                                            this.fieldContainer.append(lay.rootNode);
                                        }.bind(this));
                                    }.bind(this));

                                }

                            },
                        getTypeFromValue:function(val)
                        {
                            var typeField = Siviglia.issetOr(this.definition.TYPE_FIELD,null);
                            if(typeField!=null)
                                return val[typeField];;

                            for(var ss in this.definition.TYPE_TYPE)
                            {
                                if(val.constructor.toString().match(ss)==ss)
                                    return this.definition.TYPE_TYPE[ss].TYPE;
                            }
                        },
                        getValue: function () {
                            if (this.subNode && !this.subNode.isUnset())
                                return this.subNode.getValue();
                            return null;
                        },
                        save: function () {
                            if (this.subNode && !this.subNode.isUnset())
                                return this.subNode.save();
                            return null;
                        },
                        setType: function (typeName) {
                            if(Siviglia.isset(this.definition.TYPE_FIELD)) {
                                var c = {};
                                c[this.definition.TYPE_FIELD] = typeName;
                            }
                            this.setValue(c);
                        },
                        getAllowedTypes: function () {
                            var result = [];
                            if(Siviglia.isset(this.definition.TYPE_FIELD)) {
                                for (var k = 0; k < this.definition.ALLOWED_TYPES.length; k++) {
                                    var n = this.definition.ALLOWED_TYPES[k];
                                    result.push({LABEL: n, VALUE: n});
                                }
                            }
                            else
                            {
                                for(var ss in this.definition.TYPE_TYPE)
                                {
                                    var cc=this.definition.TYPE_TYPE[ss];
                                    result.push({name:cc.LABEL,value:cc.TYPE});
                                }
                            }
                            return result;
                        },
                        getCurrentType: function () {
                            if (Siviglia.isset(this.receivedValue)) {
                                if(Siviglia.isset(this.definition.TYPE_FIELD)) {
                                    var typeField = this.definition.TYPE_FIELD;
                                    return this.receivedValue[typeField];
                                }
                                else
                                {
                                    for(var ss in this.definition.TYPE_TYPE)
                                    {
                                        var cc=this.definition.TYPE_TYPE[ss];
                                        if(this.receivedValue.constructor.toString().match(ss) != null)
                                            return cc.TYPE;
                                    }
                                }
                            }
                            return this.currentType;
                        },
                        getSubNode: function () {
                            return this.subNode;
                        },
                        __getCurrentPath: function (obj) {
                            if (this.parent == null)return '/ROOT';
                            return this.parent.__getCurrentPath(this);
                        }
                    }

                },

                DefaultLayout:
                    {
                        inherits: "Siviglia.UI.Expando.View",
                        destruct:function()
                        {
                            this.input.destruct();
                        },
                        methods:
                            {
                                preInitialize:function(params)
                                {
                                    this.label=params.name;
                                    this.input=params.input;
                                    if(typeof this.input.type.definition.LABEL!=="undefined")
                                        this.label=this.input.type.definition.LABEL;
                                    else
                                        this.label="<NO LABEL>";
                                },
                                initialize:function(params)
                                {
                                    this.inputNode.append(this.input.rootNode)
                                }
                            }
                    },
                NewItem:
                    {
                        inherits:"Siviglia.UI.Expando.View,Siviglia.Dom.EventManager",
                        methods:
                            {
                                preInitialize:function(params)
                                {
                                    this.type=params.type;
                                    this.parent=params.parent;
                                    this.subType=null;
                                    this.subInput=null;
                                    this.params=params;
                                    this.source=null;

                                },
                                initialize:function()
                                {
                                    this.type.addListener("CHANGE",this,"paintInput");
                                    var m=this;
                                    if (this.type.hasSource()) {
                                        var source=this.type.getSource(this.type.controller.view,{});
                                        source.addListener("CHANGE", null, function (ev,data) {
                                            m.paintInput(data?data.data:null);
                                        });
                                        m.source=this;
                                        source.fetch();
                                    }
                                    else
                                        this.paintInput(null);
                                },
                                detach:function()
                                {
                                    this.type.removeListeners(this);
                                    if(this.source)
                                        this.source.removeListeners(this);
                                },
                                paintInput:function(data)
                                {
                                    var factory=new Siviglia.inputs.jqwidgets.Factory();
                                    if(this.subType)
                                        this.subType.destruct();

                                    if(this.subInput)
                                        this.subType.destruct();

                                    if (this.type.hasSource()) {

                                        if(!data)
                                            data=[];
                                        data=this.type.intersect(data);
                                        this.subType=new Siviglia.types.Enum({
                                           "TYPE":"Enum",
                                            "VALUES":data
                                        });
                                    }
                                    else {
                                        this.subType=new Siviglia.types.String({
                                            "TYPE":"String"
                                        });
                                    }
                                    factory.getInput(this.subType,{controller:this.parent.type.controller},this.form).then(function(instance){
                                    this.subInput=instance;
                                    this.inputNode.html('');
                                    this.inputNode.append(this.subInput.rootNode);
                                    }.bind(this));
                                },
                                onAdd: function () {
                                    this.parent.onAdd(this.subInput.getValue());

                                }
                            }
                    }
            }
        }
    )


</script>

<div style="display:none">
    <div data-sivWidget="Siviglia.inputs.jqwidgets.String" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.String">
        <input type="text" data-sivId="inputNode"></input>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Enum" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Enum">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Integer" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Integer">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Decimal" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Decimal">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Text" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Text">
        <textarea data-sivId="inputNode"></textarea>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Boolean" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Boolean">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Date" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Date">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.DateTime" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.DateTime">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.ComboBox" data-widgetParams="type,inputParams,sourceParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.ComboBox">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.BooleanCombo" data-widgetParams="type,inputParams,sourceParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.BooleanCombo">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.FixedSelect" data-widgetParams="type,inputParams,sourceParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.FixedSelect">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Relationship" data-widgetParams="type,inputParams,sourceParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Relationship">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Date" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Date">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Money" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Money">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Password" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Password">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.State" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Date">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Name" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Date">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Street" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Street">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.City" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.City">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Phone" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Phone">
        <div data-sivId="inputNode"></div>
    </div>
    <div data-sivWidget="Siviglia.inputs.jqwidgets.UUID" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.UUID">
        <div data-sivId="inputNode"></div>
    </div>

    <div data-sivWidget="Siviglia.inputs.jqwidgets.DefaultLayout" data-widgetParams="name,input" data-widgetCode="Siviglia.inputs.jqwidgets.DefaultLayout">
        <div class="container">
            <div class="row">
                <div class="col col-sm-2" data-sivValue="/*label"></div>
                <div class="col-sm-10" data-sivId="inputNode"></div>
            </div>
        </div>
    </div>

    <div data-sivWidget="Siviglia.inputs.jqwidgets.Dictionary" data-widgetParams="type,inputParams" data-widgetCode="Siviglia.inputs.jqwidgets.Dictionary"
         class="DictionaryType ContainerType">
        <div class="panel panel-primary">
            <div class="panel-heading" data-sivValue="/*title" class="title"></div>
            <div class="panel-body">
                <!--<div class="container-fluid">-->
                <p class="text-info description" data-sivValue="/*description"></p>
                <div data-sivIf="[%/*hasSimpleType%] == false">

                    <div class="row" style="margin-left:0px">

                        <div style="display:flex">

                            <div class="containerLabel" width="150px">

                                <div class="well">

                                    <ul  class="nav nav-stacked" data-sivLoop="/*type/[[KEYS]]" data-contextIndex="current">

                                        <li role="presentation">
                                            <button class="btn btn-primary" data-sivValue="/@current/LABEL" data-sivEvent="click" data-sivCallback="onLabelClicked" data-sivParams='{"key":"/@current/LABEL"}'></button>
                                            <span class="removebutton" style="float:right" data-sivEvent="click" data-sivCallback="onRemoveClicked" data-sivParams='{"key":"/@current/LABEL"}'></span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="newItemWidget" data-sivCall="buildNewItemWidget"></div>
                            </div>
                            <div data-sivIf="[%/*hasCurrentKey%] == true">
                                <div class="containerInput dictionaryInput">
                                    <div class="currentWidget" data-sivCall="getInputFor" data-sivParams='{"key":"/*currentKey"}'>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
                <div data-sivIf="[%/*hasSimpleType%] == true" >
                    POR 2;
                    <div  data-sivLoop="/*type/[[KEYS]]" data-contextIndex="current">

                        <div style="display:flex">
                            <div>
                                <span class="label label-primary" data-sivValue="/@current"></span>
                            </div>
                            <div>
                                <span data-sivCall="getInputFor" data-sivParams='{"key":"/@current-index"}'></span>
                            </div>
                            <div>
                                <span class="removebutton" style="float:right" data-sivEvent="click" data-sivCallback="onRemoveClicked" data-sivParams='{"key":"/@current"}'></span>
                            </div>
                        </div>
                    </div>
                    <div class="newItemWidget" data-sivCall="buildNewItemWidget"></div>
                </div>

                <!--</div>-->
            </div>
            <div class="actions">
                <div class="addItem" data-sivId="newItemNode"></div>
                <div style="float:right" class="saveNode" data-sivId="saveNode">
                    <input type="button" value="Guardar" data-sivEvent="click" data-sivCallback="doSave">
                </div>
                <div style="clear:both"></div>
            </div>
        </div>
    </div>
<!--
    ----------------------------------------------------------------------------------------
-->
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Container" data-widgetParams="type,inputParams" data-widgetCode="Siviglia.inputs.jqwidgets.Container"
         class="ContainerType">
        <div class="panel panel-primary">
            <!--<div class="panel-heading" data-sivValue="/*title" class="title"></div>-->
            <div class="panel-body">
                <p class="text-info description" data-sivValue="/*description"></p>
                <div class="inputs container" data-sivLoop="/*type/definition/FIELDS" data-contextIndex="current">
                    <div data-sivCall="getInputFor" data-sivParams='{"key":"/@current-index"}'></div>
                </div>
            </div>
        </div>
    </div>
    <!--
    ----------------------------------------------------------------------------------------
-->
    <div data-sivWidget="Siviglia.inputs.jqwidgets.FlexContainer" data-widgetParams="type,inputParams" data-widgetCode="Siviglia.inputs.jqwidgets.FlexContainer"
         class="ContainerType">

                <div style="display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start" data-sivLoop="/*type/definition/FIELDS" data-contextIndex="current">

                            <div style="margin:4px" data-sivCall="getInputFor" data-sivParams='{"key":"/@current-index"}'></div>

                </div>

    </div>
<!--
    --------------------------------------------------------------------------------------------
-->


        <div data-sivWidget="Siviglia.inputs.jqwidgets.FixedDictionary" data-widgetParams="type,inputParams" data-widgetCode="Siviglia.inputs.jqwidgets.FixedDictionary"
             class="DictionaryType ContainerType">
            <div class="panel panel-primary">
                <div class="panel-heading" data-sivValue="/*title" class="title"></div>
                <div class="panel-body">
                    <p class="text-info description" data-sivValue="/*description"></p>

                    <div class="row" style="margin-bottom:10px;margin-left:0px">
                        <div class="containerLabel well" style="margin-right:5px">

                            <ul  class="nav nav-stacked" data-sivLoop="/*type/getKeys" data-contextIndex="current">
                                <li role="presentation">
                                    <button class="btn btn-primary" data-sivValue="/@current" data-sivEvent="click" data-sivCallback="onLabelClicked" data-sivParams='{"key":"/@current"}'></button>
                                    <span class="removebutton" style="float:right" data-sivEvent="click" data-sivCallback="onRemoveClicked" data-sivParams='{"key":"/@current"}'></span>
                                </li>
                            </ul>

                            <div class="newItemWidget" data-sivId="newItemNode" data-sivCall="buildNewItemWidget" ></div>
                        </div>
                        <div class="containerInput dictionaryInput" style="padding-right:10px;padding-left:10px">
                            <div class="currentWidget" data-sivCall="getInputFor" data-sivParams='{"key":"/*currentKey"}'>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <div class="addItem" data-sivId="newItemNode"></div>
                        <div style="clear:both"></div>
                    </div>
                </div>

            </div>
        </div>
<!--
    ------------------------------------------------------------------------------------------------------
    -->

            <div data-sivWidget="Siviglia.inputs.jqwidgets.Array" data-widgetParams="parentObject,parentNode,value" data-widgetCode="Siviglia.inputs.jqwidgets.Array" class="ArrayType">
                <!--<p class="text-info description" data-sivValue="/*description"></p>-->
                <div data-sivIf="[%/*hasSimpleType%] == true" >
                    <div data-sivLoop="/*type" data-contextIndex="current" class="arrayValues" style="min-height:20px;margin-bottom:5px">
                        <span style="border:2px solid red;margin:3px;padding:2px;border-radius:5px">
                            <span  data-sivValue="/@current"></span>
                            <button style="color:red" data-sivEvent="click" data-sivCallback="onRemoveItem" data-sivParams='{"index":"/@current-index"}'>x</button>
                        </span>
                    </div>
                    <div>
                    <div data-sivId="newItemNode" data-sivCall="buildNewItemWidget"></div>
                        <button data-sivId="addSimpleItem"  data-sivEvent="click" data-sivCallback="onNewItem">Add</button>
                    </div>
                </div>
                <div data-sivIf="[%/*hasSimpleType%] == false" >
                    <div style="display:flex;flex-direction:row;flex-wrap:nowrap">
                    <div data-sivLoop="/*type/[[KEYS]]"  style="width:100px" data-contextIndex="current" class="arrayValues" style="min-height:20px;margin-bottom:5px">
                        <a data-sivEvent="click" data-sivParams='{"key":"@current-index/VALUE"}' data-sivCallback="getInputFor" class="label label-primary" style="margin-right:4px;font-size:14px" data-sivValue="[%@current/VALUE%]"></a>
                        <span class="remove ion-close-circled " style="color:red;padding-left:5px" data-sivEvent="click" data-sivCallback="onRemoveClicked" data-sivParams='{"key":"/@current"}'></span>
                    </div>
                        <div style="border:1px solid black" data-sivId="currentItemNode">

                        </div>
                    </div>
                    <button data-sivId="addSimpleItem"  data-sivEvent="click" data-sivCallback="onNewItem">Add</button>
                </div>



            </div>
    <!--
    ------------------------------------------------------------------------------------------------------
    -->
                <div data-sivWidget="Siviglia.inputs.jqwidgets.ObjectArray" data-widgetParams="parentObject,parentNode,value" data-widgetCode="Siviglia.inputs.jqwidgets.ObjectArray" class="ArrayType">
                    <p class="text-info description" data-sivValue="/*description"></p>
                    <div class="row" style="margin-left:0px">

                        <div data-sivIf="[%/*keyDirection%] == VERTICAL">
                            <div style="display:flex">
                                <div class="well">
                                    <ul  class="nav nav-stacked" data-sivLoop="/*type/children" data-contextIndex="current">
                                        <li role="presentation">
                                            <button class="btn btn-primary" data-sivCall="getLabel" data-sivValue="/@current" data-sivEvent="click" data-sivCallback="onLabelClicked" data-sivParams='{"index":"/@current-index"}'></button>
                                            <span class="removebutton" style="float:right" data-sivEvent="click" data-sivCallback="onRemoveClicked" data-sivParams='{"key":"/@current-index"}'></span>
                                        </li>
                                    </ul>
                                    <div class="newItemWidget" data-sivId="newItemNode">
                                        <input type="button" data-sivEvent="click" data-sivCallback="addItem">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div data-sivIf="[%/*keyDirection%] == HORIZONTAL">
                            <div>
                                <span class="newItemWidget add" data-sivId="newItemNode" data-sivEvent="click" data-sivCallback="addItem">
                                </span>
                                <span  data-sivLoop="/*type/children" data-contextIndex="current">
                                    <span class="label label-primary" style="display:inline-block;margin-right:4px;font-size:14px">
                                        <span data-sivCall="getLabel"  data-sivEvent="click" data-sivCallback="onLabelClicked" data-sivParams='{"index":"/@current-index"}'></span>
                                        <span class="removebutton" data-sivEvent="click" data-sivCallback="onRemoveClicked" data-sivParams='{"key":"/@current-index"}'></span>
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="containerInput dictionaryInput">
                            <div class="currentWidget">
                            </div>
                        </div>

                    </div>
                </div>
    <!--
        ---------------------------------------------------------------------------------------------
        -->
    <div data-sivWidget="Siviglia.inputs.jqwidgets.TypeSwitcher" data-widgetParams="parentObject,parentNode,value" data-widgetCode="Siviglia.inputs.jqwidgets.TypeSwitcher" class="TypeSwitchType">
        <div class="panel panel-primary">
            <div class="panel-body">

                <div class="typeChanger">
                    <div data-sivId="typeSwitchSelector">
                    </div>
                </div>
                <div data-sivId="fieldContainer"></div>
            </div>

        </div>
    </div>
     <!--
            ---------------------------------------------------------------------------------------
            -->
    <div data-sivWidget="Siviglia.inputs.jqwidgets.NewItem" data-widgetParams="parentObject,parentNode" data-widgetCode="Siviglia.inputs.jqwidgets.NewItem" class="NewItem">
            <div style="display:table-row">
                <div style="display:table-cell" data-sivId="inputNode">
                </div>
                <div style="display:table-cell;vertical-align: top;line-height: 1.0;font-size: 20px;"><div data-sivEvent="click" data-sivCallback="onAdd" class="add"></div></div>
            </div>
    </div>
    <!--
            ---------------------------------------------------------------------------------------
            -->
    <div data-sivWidget="Siviglia.inputs.jqwidgets.Form" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.Form">
        <div data-sivId="formNode"></div>
    </div>


    <div data-sivWidget="Siviglia.inputs.jqwidgets.FilteringForm" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.FilteringForm">
        <div data-sivId="formNode"></div>
    </div>

    <!--
    <div data-sivWidget="AUTOPAINTER_TypeSwitcher" data-widgetParams="parentObject,parentNode" data-widgetCode="Siviglia.AutoUI.Painter.TypeSwitchPainter" class="TypeSwitchType">
        <div class="panel panel-primary">

            <div class="panel-body">
                <div data-sivId="fieldContainer"></div>
                <div class="typeChanger">
                    <div data-sivId="typeSwitchSelector">
                    </div>
                </div>
            </div>

        </div>
    </div>
-->
    <!--
    ---
    -->
    <div data-sivWidget="Siviglia.inputs.jqwidgets.TabbedContainer" data-widgetParams="type,inputParams"
         data-widgetCode="Siviglia.inputs.jqwidgets.TabbedContainer">
        <div data-sivId='jqxTabs'>
            <ul style='margin-left: 10px;' data-sivLoop="/*labels" data-contextIndex="current">
                <li data-sivValue="[%@current%]"></li>
            </ul>
        </div>
        <div data-sivId="groups" style="display:none" data-sivLoop="*containerGroups" data-contextIndex="current">
            <div data-sivLoop="*containerGroups/{%@current-index%}/FIELDS" data-contextIndex="current2">

                <div>
                    <div data-sivCall="getInputFor" data-sivParams='{"key":"@current2/VALUE"}'></div>
                </div>

            </div>
        </div>
    </div>

</div>

